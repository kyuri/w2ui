/* kicstart 0.x (c) http://w2ui.com/kickstart, vitmalina@gmail.com */
var app=function(){function header(a){$(document).attr("title",$("<div/>").html(a).text()),$("#app-header").html(a)}function timer(){timer_start=(new Date).getTime(),timer_lap=(new Date).getTime(),console.log("Start Timer")}function lap(a){a="string"!=typeof a?"":' "'+a+'"',console.log("Total:",(new Date).getTime()-timer_start,"Lap"+a+":",(new Date).getTime()-timer_lap),timer_lap=(new Date).getTime()}function register(a,b){if(app.hasOwnProperty(a))return console.log("ERROR: Namespace "+a+" is already registered"),!1;var c=null;for(var d in app.modules)app.modules[d].name==a&&(c=app.modules[d]);app[a]=b(c.files,c)}function load(names){function isFinished(){0==modCount&&(failed!==!0&&("function"==typeof app.config.done&&app.config.done(app.modules[name]),"function"==typeof promise._done&&promise._done(app.modules[name])),"function"==typeof app.config.always&&app.config.always(app.modules[name]),"function"==typeof promise._always&&promise._always())}$.isArray(names)||(names=[names]);var modCount=names.length,failed=!1,promise={ready:function(a){return promise._ready=a,promise},fail:function(a){return promise._fail=a,promise},done:function(a){return promise._done=a,promise},always:function(a){return promise._always=a,promise}};return setTimeout(function(){for(var n in names){var name=names[n];"undefined"!=typeof app.modules[name]?(modCount--,isFinished()):$.ajax({url:name+"/module.json",dataType:"json"}).done(function(data,status,xhr){"/"!=data.main.substr(0,1)&&(data.main=name+"/"+data.main);for(var a in data.assets)"/"!=data.assets[a].substr(0,1)&&(data.assets[a]=name+"/"+data.assets[a]);app.modules[name]=data,app.get(data.assets.concat([data.main]),function(files){var main=files[data.main];delete files[data.main],app.modules[name].files=files,app.modules[name].status="loaded";try{eval(main)}catch(e){failed=!0;var err=e.stack.split("\n"),tmp=err[1].match(/<anonymous>:([\d]){1,10}:([\d]{1,10})/gi);tmp&&(tmp=tmp[0].split(":")),tmp?(console.error("ERROR: "+err[0]+" ==> "+data.main+", line: "+tmp[1]+", character: "+tmp[2]),console.log(e.stack)):(console.error("ERROR: "+data.main),console.log(e.stack)),"function"==typeof app.config.fail&&app.config.fail(app.modules[name]),"function"==typeof promise._fail&&promise._fail(app.modules[name])}"function"==typeof app.config.ready&&app.config.ready(app.modules[name]),"function"==typeof promise._ready&&promise._ready(app.modules[name]),modCount--,isFinished()})}).fail(function(){app.modules[name]={status:"error",msg:"Error while loading cofing"},failed=!0,"function"==typeof app.config.fail&&app.config.fail(app.modules[name]),"function"==typeof promise._fail&&promise._fail(app.modules[name]),modCount--,isFinished()})}},1),promise}function get(a,b){function c(){e--,0>=e&&b(d)}var d={},e=a.length;for(var f in a)!function(){var b=a[f];$.ajax({url:b,dataType:"text",success:function(a,e,f){return"success"!=e?void console.log("ERROR: error while getting a file "+b+"."):(d[b]=f.responseText,void c())},error:function(e,g,h){"error"==g?console.log("ERROR: failed to load "+a[f]+"."):(console.log('ERROR: file "'+a[f]+'" is loaded, but with a parsing error(s) in line '+h.line+": "+h.message),d[b]=responseObj.responseText,c())}})}()}function include(a){"string"==typeof a&&(a=[a]);for(var b in a)$(document).append('<script type="text/javascript" src="'+a[b]+'"></script>')}function init(){-1==document.location.href.indexOf("login.html")&&setTimeout(function(){w2popup.open({width:300,height:60,modal:!0,body:'<div style="text-align: center; font-size: 16px; padding-top: 20px; padding-left: 35px;">		<div class="w2ui-spinner" style="width: 26px; height: 26px; position: absolute; margin-left: -35px; margin-top: -5px;"></div>		Loading...</div>'})},1),app.get(["app/conf/session.js"],function(data){try{for(var i in data)eval(data[i])}catch(e){}if(!(document.location.href.indexOf("login.html")>0)){if(app.user=app.session(),$.isEmptyObject(app.user))return void(document.location="login.html");var files=["app/conf/action.js","app/conf/config.js","app/conf/start.js"];app.get(files,function(data){function initApp(){if(0==$("#app-main").length)return void setTimeout(initApp,100);$("#app-toolbar").w2toolbar(app.config.app_toolbar),$("#app-tabs").w2tabs(app.config.app_tabs),$("#app-main").w2layout(app.config.app_layout);var a=0;app.config.show.toolbar?($("#app-toolbar").css("height","30px").show(),a+=30):$("#app-toolbar").hide(),app.config.show.tabs?($("#app-tabs").css({top:a+"px",height:"30px"}).show(),a+=30):$("#app-tabs").hide(),$("#app-top").css("height",a+"px").show(),app.config.show.header?($("#app-header").css({top:a+"px",height:"60px"}).show(),a+=60):$("#app-header").hide(),$("#app-main").css("top",a+"px"),setTimeout(function(){$("#app-container").fadeIn(300),"function"==typeof app.start&&app.start(),setTimeout(function(){w2popup.close()},300)},300)}try{for(var i in data)eval(data[i])}catch(e){app.include(files)}initApp()})}})}var timer_start,timer_lap,app={};return app.user={},app.config={},app.modules={},app.header=header,app.timer=timer,app.lap=lap,app.register=register,app.load=load,app.get=get,app.include=include,app.action=null,app.start=null,app.session=null,app.login=null,app.logout=null,app.forgot=null,init(),app}(app||{});app.route=function(){function a(a,b){if("object"==typeof a){for(var c in a){var d=String("/"+c).replace(/\/{2,}/g,"/");i[d]=a[c]}return app.route}return a=String("/"+a).replace(/\/{2,}/g,"/"),i[a]=b,app.route}function b(a){return a=String("/"+a).replace(/\/{2,}/g,"/"),delete i[a],delete j[a],app.route}function c(a){return a=String("/"+a).replace(/\/{2,}/g,"/"),setTimeout(function(){window.location.hash=a},1),app.route}function d(){return window.location.hash.substr(1).replace(/\/{2,}/g,"/")}function e(){g();var a={};for(var b in i){var c=j[b].keys,d=[];for(var e in c)d.push(c[e].name);a[b]=d}return a}function f(){g();var a=window.location.hash.substr(1).replace(/\/{2,}/g,"/");""==a&&(a="/");var b=a.split("/");if(b[1]&&"undefined"==typeof app[b[1]])k.debug&&console.log("ROUTE: load module "+b[1]),app.load("app/"+b[1]).done(function(){f()});else for(var c in j){var d={},b=j[c].path.exec(a);if(b){var e=1;for(var h in j[c].keys)d[j[c].keys[h].name]=b[e],e++;k.debug&&console.log("ROUTE:",c,d),i[c](c,d)}}}function g(){for(var a in i)if(!j[a]){var b=[],c=a.replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(a,c,d,e,f,g){return b.push({name:e,optional:!!g}),c=c||"",""+(g?"":c)+"(?:"+(g?c:"")+(d||"")+(f||d&&"([^/.]+?)"||"([^/]+?)")+")"+(g||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)");j[a]={path:new RegExp("^"+c+"$","i"),keys:b}}}function h(){window.addEventListener?window.addEventListener("hashchange",f,!1):window.attachEvent("onhashchange",f)}var i={},j={},k={debug:!1};return h(),{add:a,remove:b,go:c,get:d,process:f,list:e}}();